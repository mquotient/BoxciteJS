<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Test Actions</title>
		<script src="xmlrpc.js"></script>
		<script src="boxcite.js"></script>
		<style>
			form {
				margin: 16px; padding: 10px 20px;
				width: 480px;
			}
			label { margin: 12px auto; display: block; }
			input { float: right; }
		</style>
	</head>
	<body>
		<label>Successfully logged-in... <button onclick="logout();">Logout</button></label>
		<form id="contact_form" method="post">
			<label>First Name: <input type="text" id="first_name" value="Sreejith" /></label>
			<label>Last Name: <input type="text" id="last_name" value="Narayanan" /></label>
			<label>Add Contact: <input type="submit" value="Go!" onclick="addContact();" /></label>
		</form>
		<form id="upload_form" method="post" enctype="multipart/form-data">
			<label>Select File: <input type="file" id="file" name="file" /></label>
			<label>Delimiter: <input type="text" id="delimiter" name="delimiter" value="," /></label>
			<label>First Row as Header: <input type="checkbox" id="header" name="header" checked="checked" /></label>
			<label>Quoted Field as Text: <input type="checkbox" id="quotes" name="quotes" checked="checked" /></label>
			<input type="hidden" id="sessionid" name="sessionID" value="contact.getCookie('sessionID');" />
			<label>Send File to Server: <input type="button" value="Upload" onclick="uploadFile();" /></label>
		</form>
		<label>Get Categories... <button onclick="findCategories();">Go!</button></label>
		<label>Get Contacts... <button onclick="findContacts();">Go!</button></label>
		<label>Read Contact... <button onclick="readContacts();">Go!</button></label>
		<label>Update Contact... <button onclick="updateContacts();">Go!</button></label>
		<script>
			//user.URL = "http://192.168.1.108:8080/xmlrpc/";
			//contact.URL = "http://192.168.1.108:8080/xmlrpc/";
			contact.tmpCache = {};
			user.URL = "http://sreejith.dyndns-home.com:18080/xmlrpc/";
			contact.URL = "http://sreejith.dyndns-home.com:18080/xmlrpc/";
 			function logout () {
				var response = user.logout();
				if (response.success == true) {
					alert("Logged Out!");
				} else {
					alert(response.fail_message);
				}
				location.replace("index.html");
 			}
 			function addContact () {
 				var data = { data : {
 					first_name : document.getElementById("first_name").value,
 					last_name : document.getElementById("last_name").value
 				}}
 				try {
				var response = contact.create( data );
					console.log(response);
				} catch ( err ) {
					alert( err );
				}
				if (response.success == true) {
					alert("Record Added!");
				}
				else {
					alert(response.fail_message);
				}
 			}
			function uploadFile() {
				try {
					var fileData = new FormData();
					fileData.append("delimiter", document.getElementById('delimiter').value);
					fileData.append("header", document.getElementById('header').value);
					fileData.append("quotes", document.getElementById('quotes').value);
					fileData.append("sessionid", document.getElementById('sessionid').value);
					fileData.append("file", document.getElementById('file').files[0]);

					var xhr = new XMLHttpRequest();
					//xhr.open("POST", 'http://192.168.1.108:8080/web/upload/',false);
					xhr.open("POST", 'http://sreejith.dyndns-home.com:18080/web/upload/',false);
					xhr.send(fileData);
					var result = JSON.parse( xhr.response );
					console.log( result );
					if ( result.success == true ) {
						var file = result.id;
						var mapping = {
							first_name: [0],
							middle_name: [1],
							last_name: [2],
							phone_numbers: [5,6],
							emails: [3,4],
							work_address: { addr_1: 7, addr_2: 8, city: 9 }
						};
						var categories = { address_book : ['legolus'] };
						resonse = creatFromFile( file, mapping, categories );
						console.log( response );
					} else {
						alert( result.fail_message );
					}
				} catch ( err ) {
					alert( err );
				}
			}
			function creatFromFile ( file_id, mapping, categories ) {
				var data = { data : {
					file : file_id,
					mapping : mapping,
					categories: categories
					}
				}
				try {
					var response = contact.createFromFile( data );
				} catch ( err ) {
					alert ( err );
				}
				console.log(response.result);
				if (response.success == true) {
					alert( "Success: " + response.result);
				} else {
					alert( "Fail :" + response.fail_message);
				}
			}
			function findContacts () {
				var data = { data : {
					criteria : {},
					start : 0,
					number_results : 20,
					sort_fields : [],
					sort_order : "ASC" }
				}
				try {
					var response = contact.findContacts( data );
				} catch ( err ) {
					alert ( err );
				}
				console.log(response.result);
				if (response.success == true) {
					alert( "Success: " + response.result);
				} else {
					alert( "Fail :" + response.fail_message);
				}
			}
			function findCategories () {
				var data = { data : {
					type : "address_book",
					criteria : {},
					start : 0,
					number_results : 20,
					sort_fields : [],
					sort_order : "ASC" }
				}
				try {
					var response = contact.findCategories( data );
				} catch ( err ) {
					alert ( err );
				}
				console.log( response );
				if (response.success == true) {
					alert( "Success: " + response.result);
				} else {
					alert( "Fail :" + response.fail_message);
				}
			}
			function readContacts () {
				var data = { data : {
					id : "4ecd1592d3882f2ea5000000",
					fields : [],
					read_type : "basic" }
				}
				try {
					var response = contact.read( data );
					contact.tmpCache = response.result;
				} catch ( err ) {
					alert ( err );
				}
				console.log( response );
				if (response.success == true) {
					alert( "Success: " + response.result);
				} else {
					alert( "Fail :" + response.fail_message);
				}
			}
			function updateContacts () {
				contact.tmpCache.first_name = "Sreejith";
				var data = { data : {
					id : "4ecd1592d3882f2ea5000000",
					data : contact.tmpCache,
					read_type : "basic" }
				}
				try {
					var response = contact.update( data );
					console.log(response);
				} catch ( err ) {
					alert ( err );
				}
				console.log( response );
				if (response.success == true) {
					alert( "Success: " + response.result);
				} else {
					alert( "Fail :" + response.fail_message);
				}
			}
		</script>
	</body>
</html>
