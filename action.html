<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Test Actions</title>
		<script src="xmlrpc.js"></script>
		<script src="boxcite.js"></script>
		<style>
			form {
				margin: 16px; padding: 10px 20px;
				width: 480px;
			}
			label { margin: 12px auto; display: block; }
			input { float: right; }
		</style>
	</head>
	<body>
		<label>Successfully logged-in... <button onclick="logout();">Logout</button></label>
		<form id="contact_form" method="post">
			<label>First Name: <input type="text" id="first_name" value="Sreejith" /></label>
			<label>Last Name: <input type="text" id="last_name" value="Narayanan" /></label>
			<label>Add Contact: <input type="submit" value="Go!" onclick="addContact();" /></label>
		</form>
		<form id="upload_form" method="post" enctype="multipart/form-data">
			<label>Select File: <input type="file" id="file" name="file" /></label>
			<label>Delimiter: <input type="text" id="delimiter" name="delimiter" value="," /></label>
			<label>First Row as Header: <input type="checkbox" id="header" name="header" checked="checked" /></label>
			<label>Quoted Field as Text: <input type="checkbox" id="quotes" name="quotes" checked="checked" /></label>
			<input type="hidden" id="sessionid" name="sessionID" value="contact.getCookie('sessionID');" />
			<label>Send File to Server: <input type="button" value="Upload" onclick="uploadFile();" /></label>
		</form>
		<script>
			user.URL = "http://sreejith.dyndns-home.com:18080/xmlrpc/";
			contact.URL = "http://sreejith.dyndns-home.com:18080/xmlrpc/";
 			function logout () {
				var response = user.logout();
				if (response.success == true) {
					alert("Logged Out!");
				}
				else {
					alert(response.fail_message);
				}
 			}
 			function addContact () {
 				var data = { data : {
 					first_name : document.getElementById("first_name").value,
 					last_name : document.getElementById("last_name").value
 				}}
 				try {
				var response = contact.create( data );
					console.log(response);
				} catch ( err ) {
					alert( err );
				}
				if (response.success == true) {
					alert("Record Added!");
				}
				else {
					alert(response.fail_message);
				}
 			}
			function uploadFile() {
				try {
					var fileData = new FormData();
					fileData.append("delimiter", document.getElementById('delimiter').value);
					fileData.append("header", document.getElementById('header').value);
					fileData.append("quotes", document.getElementById('quotes').value);
					fileData.append("sessionid", document.getElementById('sessionid').value);
					fileData.append("file", document.getElementById('file').files[0]);

					var xhr = new XMLHttpRequest();
					xhr.open("POST", 'http://sreejith.dyndns-home.com:18080/web/upload/',true);
					xhr.send(fileData);

					var response = xmlrpc_decode(xhr.responseXML);
					alert(response.id);
				} catch ( err ) {
					alert( err );
				}
			}
		</script>
	</body>
</html>
